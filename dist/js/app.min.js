import{fetchRecipes}from"./api.min.js";import{Recipe}from"./recipe.min.js";let recipes=[],selectedItems={ingredients:new Set,appliances:new Set,ustensils:new Set},escapeHtml=e=>{let t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,e=>t[e])},searchRecipesNative=(e,t)=>{var s=e.toLowerCase(),r=[];for(let e=0;e<t.length;e++){var c=t[e];matchesQuery(s,c)&&r.push(c)}return r},matchesQuery=(e,t)=>t.name.toLowerCase().includes(e)||t.ingredients.map(e=>e.ingredient.toLowerCase()).join(" ").includes(e)||t.description.toLowerCase().includes(e),matchesSelectedItems=(e,t)=>matchesAllItems(e.ingredients,t.ingredients,"ingredient")&&matchesSingleItem(e.appliance,t.appliances)&&matchesAllItems(e.ustensils,t.ustensils),matchesAllItems=(e,t,s)=>Array.from(t).every(t=>e.some(e=>(s?e[s]:e).toLowerCase()===t.toLowerCase())),matchesSingleItem=(e,t)=>0===t.size||t.has(e.toLowerCase()),main=async()=>{try{var e=await fetchRecipes("src/data/recipes.json");e&&e.recipes?(recipes=e.recipes.map(e=>new Recipe(e)),updateRecipeCount(recipes.length),displayRecipes(recipes),populateSelects(),document.querySelector("#search").addEventListener("input",e=>filterRecipes(e.target.value)),document.querySelector("#clear-button").addEventListener("click",()=>{document.querySelector("#search").value="",filterRecipes("")}),addSelectEventListeners()):console.error("No recipes found in the data")}catch(e){console.error("Error in main:",e)}},displayRecipes=t=>{var s=document.querySelector("#recipes-container");s.innerHTML="";for(let e=0;e<t.length;e++){var r=t[e],r=createRecipeCard(r);s.appendChild(r)}},createRecipeCard=e=>{var t=document.createElement("article");return t.classList.add("relative","flex","flex-col","overflow-hidden","rounded-3xl","bg-white","shadow-lg"),t.innerHTML=`
        <img src="src/assets/img/${e.image}" alt="${escapeHtml(e.name)}" class="h-64 w-full object-cover"/>
        <div class="absolute right-4 top-4 rounded-xl bg-yellow-400 px-4 py-1 text-xs text-color-site-100">${e.time}min</div>
        <div class="flex flex-grow flex-col px-6 pb-16 pt-8">
            <h2 class="mb-7 font-anton text-lg font-bold">${escapeHtml(e.name)}</h2>
            <h3 class="mb-2 text-sm font-bold uppercase tracking-wide text-color-site-300">Recette</h3>
            <p class="mb-8 flex-grow text-gray-700 line-clamp-4">${escapeHtml(truncateDescription(e.description))}</p>
            <h3 class="mb-4 text-sm font-bold uppercase tracking-wide text-color-site-300">Ingr√©dients</h3>
            <div class="grid grid-cols-2 gap-y-5">
                ${e.ingredients.map(e=>`
                    <div class="flex flex-col text-sm">
                        <span class="font-medium">${escapeHtml(e.ingredient)}</span>
                        <span class="text-color-site-300">${e.quantity||""} ${e.unit||""}</span>
                    </div>
                `).join("")}
            </div>
        </div>
    `,t},filterRecipes=e=>{e=searchRecipesNative(e,recipes).filter(e=>matchesSelectedItems(e,selectedItems));updateRecipeCount(e.length),displayRecipes(e)},updateRecipeCount=e=>{var t=document.querySelector("#recipe-count");let s;s=0===e?"00 recette":1===e?"01 recette":e.toString().padStart(2,"0")+" recettes",t.textContent=s},truncateDescription=(e,t=4)=>{var s=e.split("\n");return s.length<=t?e:s.slice(0,t).join(" ")+"..."},populateSelects=()=>{var t=new Set,s=new Set,r=new Set;for(let e=0;e<recipes.length;e++){var c=recipes[e];addItemsToSet(c.ingredients,t,"ingredient"),s.add(c.appliance),addItemsToSet(c.ustensils,r)}populateSelect("#ingredients-select",t),populateSelect("#appliances-select",s),populateSelect("#ustensils-select",r)},addItemsToSet=(t,s,r)=>{for(let e=0;e<t.length;e++)s.add(r?t[e][r]:t[e])},populateSelect=(e,t)=>{var s=document.querySelector(e),r=(s.innerHTML="",Array.from(t));for(let e=0;e<r.length;e++){var c=r[e],a=document.createElement("option");a.value=c,a.textContent=c,a.classList.add("py-2","capitalize-first-letter"),s.appendChild(a)}},addSelectEventListeners=()=>{["ingredients","appliances","ustensils"].forEach(t=>{document.querySelector(`#${t}-select`).addEventListener("change",e=>{addSelectedItem(t,e.target.value),e.target.value="",filterRecipes(document.querySelector("#search").value)})})},addSelectedItem=(e,t)=>{t&&!selectedItems[e].has(t.toLowerCase())&&(selectedItems[e].add(t.toLowerCase()),updateSelectedItemsDisplay())},updateSelectedItemsDisplay=()=>{var t=document.querySelector("#selected-items"),s=(t.innerHTML="",Object.keys(selectedItems));for(let e=0;e<s.length;e++){var r=s[e],c=Array.from(selectedItems[r]);for(let e=0;e<c.length;e++){var a=c[e],a=createListItem(r,a);t.appendChild(a)}}},createListItem=(e,t)=>{var s=document.createElement("li");return s.classList.add("flex","w-48","items-center","justify-between","rounded-lg","bg-color-site-50","p-4","text-sm"),s.innerHTML=`
        ${escapeHtml(t)}
        <button class="ml-2" onclick="removeSelectedItem('${e}', '${t}')">
            <i class="fas fa-times"></i>
        </button>
    `,s},removeSelectedItem=(e,t)=>{selectedItems[e].delete(t.toLowerCase()),updateSelectedItemsDisplay(),filterRecipes(document.querySelector("#search").value)};main(),window.removeSelectedItem=removeSelectedItem;