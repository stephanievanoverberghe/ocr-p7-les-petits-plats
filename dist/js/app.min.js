import{fetchRecipes}from"./api.min.js";import{Recipe}from"./recipe.min.js";let recipes=[],dropdownsData=[{id:"ingredients",label:"Ingrédients"},{id:"appliances",label:"Appareils"},{id:"ustensils",label:"Ustensiles"}],generateDropdown=({id:e,label:t})=>`
        <div class="dropdown-container relative inline-block w-full pb-2 text-left lg:max-w-56 lg:pb-0">
            <div class="flex flex-col justify-between">
                <button type="button"
                    class="dropdown-button mr-16 inline-flex w-full cursor-pointer items-center justify-between rounded-xl bg-white p-4">
                    ${t}
                    <i class="fa-solid fa-chevron-down arrow-icon transition-transform duration-300"></i>
                </button>
            </div>
            <div class="dropdown dropdown-panel absolute left-0 z-50 mt-0 hidden w-full origin-top transform rounded-b-xl border-t-0 border-gray-300 bg-white shadow-lg transition-all duration-300 ease-in-out">
                <div class="py-2">
                    <div class="relative mb-2 flex items-center px-4">
                        <input type="text" class="search-input w-full rounded-sm border border-color-site-400 px-3 py-2"
                            placeholder="Recherchez" />
                        <button class="clear-search-input absolute right-11 hidden p-2 text-color-site-300">
                            <i class="fas fa-times fa-xs"></i>
                        </button>
                        <div class="absolute right-7 flex items-center">
                            <i class="fa-solid fa-magnifying-glass text-color-site-300"></i>
                        </div>
                    </div>
                    <select multiple class="no-scrollbar dropdown-select h-40 w-full border-0 focus:outline-none focus:ring-0"
                        id="${e}-select"></select>
                </div>
            </div>
        </div>
    `,renderDropdowns=()=>{let t=document.querySelector("#dropdowns-container");dropdownsData.forEach(e=>{t.innerHTML+=generateDropdown(e)})},main=async()=>{try{var e=await fetchRecipes("src/data/recipes.json");e&&e.recipes?(recipes=e.recipes.map(e=>new Recipe(e)),updateRecipeCount(recipes.length),renderDropdowns(),displayRecipes(recipes),populateSelects(),document.querySelector("#search").addEventListener("input",e=>filterRecipes(e.target.value)),document.querySelector("#clear-button").addEventListener("click",()=>{document.querySelector("#search").value="",filterRecipes("")}),document.querySelectorAll(".dropdown-container").forEach(setupDropdown)):console.error("No recipes found in the data")}catch(e){console.error("Error in main:",e)}},displayRecipes=e=>{let i=document.querySelector("#recipes-container");if(i.innerHTML="",e.forEach(e=>{var t=document.createElement("article"),s=(t.classList.add("relative","flex","flex-col","overflow-hidden","rounded-3xl","bg-white","shadow-lg"),e.image.split(".").slice(0,-1).join("."));t.innerHTML=`
            <picture>
                <source data-srcset="dist/assets/img/${s}.webp" type="image/webp">
                <img data-src="dist/assets/img/${s}.webp" alt="${e.name}" class="h-64 w-full object-cover lazyload"/>
            </picture>
            <div class="absolute right-4 top-4 rounded-xl bg-yellow-400 px-4 py-1 text-xs text-color-site-100">${e.time}min</div>
            <div class="flex flex-grow flex-col px-6 pb-16 pt-8">
                <h2 class="mb-7 font-anton text-lg font-bold">${e.name}</h2>
                <h3 class="mb-2 text-sm font-bold uppercase tracking-wide text-color-site-300">Recette</h3>
                <p class="mb-8 flex-grow text-gray-700 line-clamp-4">${truncateDescription(e.description)}</p>
                <h3 class="mb-4 text-sm font-bold uppercase tracking-wide text-color-site-300">Ingrédients</h3>
                <div class="grid grid-cols-2 gap-y-5">
                    ${e.ingredients.map(e=>`
                        <div class="flex flex-col text-sm">
                            <span class="font-medium">${e.ingredient}</span>
                            <span class="text-color-site-300">${e.quantity||""} ${e.unit||""}</span>
                        </div>
                    `).join("")}
                </div>
            </div>
        `,i.appendChild(t)}),"IntersectionObserver"in window){e=document.querySelectorAll("img.lazyload");let t=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&((e=e.target).src=e.dataset.src,e.classList.remove("lazyload"),t.unobserve(e))})});e.forEach(e=>{t.observe(e)})}else document.querySelectorAll("img.lazyload").forEach(e=>{e.src=e.dataset.src,e.classList.remove("lazyload")})},updateRecipeCount=e=>{document.querySelector("#recipe-count").textContent=0===e?"00 recette":e.toString().padStart(2,"0")+" recettes"},truncateDescription=(e,t=4)=>{var s=e.split("\n");return s.length<=t?e:s.slice(0,t).join(" ")+"..."},populateSelects=()=>{let t=new Set,s=new Set,i=new Set;recipes.forEach(e=>{e.ingredients.forEach(e=>t.add(e.ingredient)),s.add(e.appliance),e.ustensils.forEach(e=>i.add(e))}),populateSelect("#ingredients-select",t),populateSelect("#appliances-select",s),populateSelect("#ustensils-select",i)},populateSelect=(e,t)=>{let s=document.querySelector(e);s.innerHTML="",t.forEach(e=>{var t=document.createElement("option");t.value=e,t.textContent=e,t.classList.add("py-2","capitalize-first-letter"),s.appendChild(t)})},filterRecipes=t=>{var e=recipes.filter(e=>e.name.toLowerCase().includes(t.toLowerCase())||e.ingredients.some(e=>e.ingredient.toLowerCase().includes(t.toLowerCase())));updateRecipeCount(e.length),displayRecipes(e)};main();