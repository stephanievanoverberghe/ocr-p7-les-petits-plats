import{fetchRecipes}from"./api.min.js";import{Recipe}from"./recipe.min.js";let recipes=[],main=async()=>{try{var e=await fetchRecipes("src/data/recipes.json");e&&e.recipes?(recipes=e.recipes.map(e=>new Recipe(e)),updateRecipeCount(recipes.length),displayRecipes(recipes),populateSelects(),document.querySelector("#search").addEventListener("input",e=>filterRecipes(e.target.value)),document.querySelector("#clear-button").addEventListener("click",()=>{document.querySelector("#search").value="",filterRecipes("")})):console.error("No recipes found in the data")}catch(e){console.error("Error in main:",e)}},displayRecipes=e=>{let s=document.querySelector("#recipes-container");if(s.innerHTML="",e.forEach(e=>{var t=document.createElement("article"),i=(t.classList.add("relative","flex","flex-col","overflow-hidden","rounded-3xl","bg-white","shadow-lg"),e.image.split(".").slice(0,-1).join("."));t.innerHTML=`
            <picture>
                <source data-srcset="dist/assets/img/${i}.webp" type="image/webp">
                <img data-src="src/assets/img/${e.image}" alt="${e.name}" class="h-64 w-full object-cover lazyload"/>
            </picture>
            <div class="absolute right-4 top-4 rounded-xl bg-yellow-400 px-4 py-1 text-xs text-color-site-100">${e.time}min</div>
            <div class="flex flex-grow flex-col px-6 pb-16 pt-8">
                <h2 class="mb-7 font-anton text-lg font-bold">${e.name}</h2>
                <h3 class="mb-2 text-sm font-bold uppercase tracking-wide text-color-site-300">Recette</h3>
                <p class="mb-8 flex-grow text-gray-700 line-clamp-4">${truncateDescription(e.description)}</p>
                <h3 class="mb-4 text-sm font-bold uppercase tracking-wide text-color-site-300">Ingr√©dients</h3>
                <div class="grid grid-cols-2 gap-y-5">
                    ${e.ingredients.map(e=>`
                        <div class="flex flex-col text-sm">
                            <span class="font-medium">${e.ingredient}</span>
                            <span class="text-color-site-300">${e.quantity||""} ${e.unit||""}</span>
                        </div>
                    `).join("")}
                </div>
            </div>
        `,s.appendChild(t)}),"IntersectionObserver"in window){e=document.querySelectorAll("img.lazyload");let t=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&((e=e.target).src=e.dataset.src,e.classList.remove("lazyload"),t.unobserve(e))})});e.forEach(e=>{t.observe(e)})}else document.querySelectorAll("img.lazyload").forEach(e=>{e.src=e.dataset.src,e.classList.remove("lazyload")})},updateRecipeCount=e=>{document.querySelector("#recipe-count").textContent=0===e?"00 recette":e.toString().padStart(2,"0")+" recettes"},truncateDescription=(e,t=4)=>{var i=e.split("\n");return i.length<=t?e:i.slice(0,t).join(" ")+"..."},populateSelects=()=>{let t=new Set,i=new Set,s=new Set;recipes.forEach(e=>{e.ingredients.forEach(e=>t.add(e.ingredient)),i.add(e.appliance),e.ustensils.forEach(e=>s.add(e))}),populateSelect("#ingredients-select",t),populateSelect("#appliances-select",i),populateSelect("#ustensils-select",s)},populateSelect=(e,t)=>{let i=document.querySelector(e);i.innerHTML="",t.forEach(e=>{var t=document.createElement("option");t.value=e,t.textContent=e,t.classList.add("py-2","capitalize-first-letter"),i.appendChild(t)})},filterRecipes=t=>{var e=recipes.filter(e=>e.name.toLowerCase().includes(t.toLowerCase())||e.ingredients.some(e=>e.ingredient.toLowerCase().includes(t.toLowerCase())));updateRecipeCount(e.length),displayRecipes(e)};main();